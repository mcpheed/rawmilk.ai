<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>rawmilk.ai — nearest raw milk</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg:#0b0c10; --card:#12141a; --muted:#9aa3b2; --text:#e8eef9; --accent:#4f8cff; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{max-width:720px;margin:0 auto;padding:20px}
  h1{margin:8px 0 16px 0;font-size:22px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  input,button{padding:10px 12px;border-radius:10px;border:1px solid #1e2430;background:#0f1117;color:var(--text);font-size:16px}
  button{background:var(--accent);border:none;cursor:pointer;font-weight:600}
  .meta{color:var(--muted);font-size:14px;margin:8px 0}
  .card{background:var(--card);border:1px solid #1e2430;border-radius:14px;padding:12px;margin:8px 0}
  .name{font-weight:700}
  .muted{color:var(--muted);font-size:14px}
  a{color:#d5e3ff;text-decoration:none;border-bottom:1px dashed rgba(213,227,255,.4)}
</style>
</head>
<body>
  <div class="wrap">
    <h1>rawmilk.ai</h1>
    <div class="row">
      <input id="addr" placeholder="Enter your address or city" style="flex:1 1 360px" />
      <button id="findBtn">Find</button>
      <button id="geoBtn" title="Use my location">Use my location</button>
    </div>
    <div id="status" class="meta">Enter your address or use your location.</div>
    <div id="list"></div>
  </div>

<script>
const statusEl = document.getElementById('status');
const listEl = document.getElementById('list');

function render(items){
  listEl.innerHTML = '';
  if (!items || !items.length){ statusEl.textContent = 'No nearby locations found.'; return; }
  statusEl.textContent = `Found ${items.length} nearby`;
  for (const l of items){
    const div = document.createElement('div');
    const addr = [l.address,l.city,l.state,l.zip].filter(Boolean).join(', ');
    div.className='card';
    div.innerHTML = `
      <div class="name">${l.name}</div>
      <div class="muted">${addr}</div>
      <div class="muted">${(l.distanceKm||0).toFixed(1)} km away</div>
      <div class="row" style="margin-top:6px">
        ${l.phone ? `<a href="tel:${l.phone}">Call</a>` : ''}
        ${l.website ? `<a href="${l.website}" target="_blank" rel="noopener">Website</a>` : ''}
      </div>
    `;
    listEl.appendChild(div);
  }
}

async function searchByAddress(){
  const q = document.getElementById('addr').value.trim();
  if (!q){ statusEl.textContent='Please enter an address or city.'; return; }
  statusEl.textContent='Searching…';
  const res = await fetch('/api/near?max=5&radiusKm=200&address='+encodeURIComponent(q));
  const data = await res.json();
  render(data.locations);
}

async function searchByGeo(){
  if (!navigator.geolocation){ statusEl.textContent='Geolocation not supported.'; return; }
  statusEl.textContent='Getting your location…';
  navigator.geolocation.getCurrentPosition(async (pos)=>{
    const { latitude, longitude } = pos.coords;
    statusEl.textContent='Searching…';
    const res = await fetch('/api/near?max=5&radiusKm=200&lat='+latitude+'&lng='+longitude);
    const data = await res.json();
    render(data.locations);
  }, (err)=>{
    statusEl.textContent='Could not get your location.';
  }, { enableHighAccuracy:true, timeout:8000, maximumAge:0 });
}

document.getElementById('findBtn').onclick = searchByAddress;
document.getElementById('geoBtn').onclick = searchByGeo;
</script>
</body>
</html>
